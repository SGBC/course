<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    
    <title>Assembling transcripts - Bioinformatics course</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/3.003/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../../css/base.min.css" rel="stylesheet">
    <link href="../../../css/cinder.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.min.css">
    <link href="../../../css/admonition.css" rel="stylesheet">
    <link href="../../../css/navbar.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.28/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Bioinformatics course</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">First week <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../blast/blast_online/">Blast Online</a>
</li>

                        
                            
<li >
    <a href="../../../unix/">Unix</a>
</li>

                        
                            
<li >
    <a href="../../../cloud/">Cloud Computing</a>
</li>

                        
                            
<li >
    <a href="../../../blast/blast_cli/">Command-line Blast</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Second week <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../seq_tech/">Sequencing Technologies</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/qc/">Quality Control</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/assembly/">De-novo Genome Assembly</a>
</li>

                        
                            
<li >
    <a href="../../../assembly_challenge/">Assembly Challenge</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/annotation/">Genome Annotation</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/pan_genome/">Pan-genome Analysis</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/nanopore/">Nanopore Sequencing</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 3 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../seq_tech/">Sequencing Technologies</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/qc/">Quality Control</a>
</li>

                        
                            
<li >
    <a href="../../../assembly_challenge/">Assembly Challenge</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/assembly/">De-novo Genome Assembly</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/annotation/">Genome Annotation</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/pan_genome/">Pan-genome Analysis</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/nanopore/">Nanopore Sequencing</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 4 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../tutorials/docs/rna/">RNA Sequencing</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Eukaryotic Annotation</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../schedule/">Intro</a>
</li>

        
            
<li >
    <a href="../practical1/">Practical 1</a>
</li>

        
            
<li >
    <a href="../practical2/">Practical 2</a>
</li>

        
            
<li >
    <a href="../practical3_manualCuration/">Practical 3</a>
</li>

        
            
<li >
    <a href="../practical4_funcAnnotInterp/">Practical 4</a>
</li>

        
            
<li >
    <a href="../UsingWebApollo.md">WebApollo</a>
</li>

        
            
<li >
    <a href="../practical2_sub_gatherEvidence/">Protein, EST and RNA-seq data</a>
</li>

        
            
<li class="active">
    <a href="./">Assembling transcripts</a>
</li>

        
            
<li >
    <a href="../practical2_sub_makerNoAbinit/">Evidence Based Annotation</a>
</li>

        
            
<li >
    <a href="../practical2_sub_makerAbinit/">Abinitio Annotation</a>
</li>

        
            
<li >
    <a href="../practical2_sub_makerCompareAnnot/">Comparing Annotations</a>
</li>

        
            
<li >
    <a href="../practical2_supl_maker/">Configuring Maker (I)</a>
</li>

        
            
<li >
    <a href="../practical2_supl3_maker/">Configuring Maker (I)</a>
</li>

        
            
<li >
    <a href="../practical2_supl2_maker/">Inspecting Maker output</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 5 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../tutorials/docs/16S/">Metabarcoding</a>
</li>

                        
                            
<li >
    <a href="../../../proteins/">Proteins</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 6 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../tutorials/docs/meta_assembly/">Metagenome assembly</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/wms/">Comparative metagenomics</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/metavir/">Viral metagenomics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../practical2_sub_gatherEvidence/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../practical2_sub_makerNoAbinit/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#assembling-transcripts-based-on-rna-seq-data">Assembling transcripts based on RNA-seq data</a></li>
            <li class="second-level"><a href="#1-genome-guided-transcriptome-assembly">1. Genome guided transcriptome assembly:</a></li>
                
                <li class="third-level"><a href="#checking-encoding-version-and-fastq-quality-score-format">Checking encoding version and fastq quality score format</a></li>
                <li class="third-level"><a href="#trimmomatic-trimming-reads">Trimmomatic (trimming reads)</a></li>
                <li class="third-level"><a href="#tophat-splice-aware-mapping-reads-to-genome">Tophat (splice-aware mapping reads to genome)</a></li>
                <li class="third-level"><a href="#stringtie-assembling-reads-into-transcripts">Stringtie (Assembling reads into transcripts)</a></li>
            <li class="second-level"><a href="#2-de-novo-transcriptome-assembly">2. De-novo transcriptome assembly:</a></li>
                
                <li class="third-level"><a href="#trinity">Trinity</a></li>
            <li class="second-level"><a href="#closing-remarks">Closing remarks</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="assembling-transcripts-based-on-rna-seq-data">Assembling transcripts based on RNA-seq data</h1>
<p>Rna-seq data is in general very useful in annotation projects as the data usually comes from the actual organism you are studying and thus avoids the danger of introducing errors caused by differences in gene structure between your study organism and other species.</p>
<p>Important remarks to remember before starting working with RNA-seq:
- Check if RNAseq are paired or not. Last generation of sequenced short reads (since 2013) are almost all paired. Anyway, it is important to check that information, which will be useful for the tools used in the next steps.
- Check if RNAseq are stranded. Indeed this information will be useful for the tools used in the next steps. (In general way we recommend to use stranded RNAseq to avoid transcript fusion during the transcript assembly process. That gives more reliable results. )
- Left / L / forward / 1 are identical meaning. It is the same for Right / R /Reverse / 2</p>
<p>First create a dedicated folder to work in:</p>
<pre><code>cd ~/annotation_course/practical2
mkdir RNAseq
cd RNAseq
</code></pre>

<h2 id="1-genome-guided-transcriptome-assembly">1. Genome guided transcriptome assembly:</h2>
<h3 id="checking-encoding-version-and-fastq-quality-score-format">Checking encoding version and fastq quality score format</h3>
<p>To check the technology used to sequences the RNAseq and get some extra information we have to use fastqc tool.</p>
<pre><code>mkdir fastqc
cd fastqc
mkdir fastqc_reports
fastqc ~/annotation_course/data/RNAseq/fastq/ERR305399.left.fastq.gz -o fastqc_reports/
</code></pre>

<p>Transfer the html file resulting of fastqc to your computer using scp in another terminal:   </p>
<pre><code>scp -i ~/.ssh/azure_rsa student@__IP__:/home/student/annotation_course/practical1/augustus/augustus_drosophila.gff .
</code></pre>

<p>Open it. What kind of result do you have?</p>
<p>Checking the fastq quality score format</p>
<pre><code>fastq_guessMyFormat.pl -i ~/annotation_course/data/RNAseq/fastq/ERR305399.left.fastq.gz
</code></pre>

<p>In the normal mode, it differentiates between Sanger/Illumina1.8+ and Solexa/Illumina1.3+/Illumina1.5+.
In the advanced mode, it will try to pinpoint exactly which scoring system is used.</p>
<p>More test can be made and should be made on RNA-seq data before doing the assembly, we have not time to do all of them during this course. have a look <a href="https://en.wikipedia.org/wiki/List_of_RNA-Seq_bioinformatics_tools">here</a></p>
<h3 id="trimmomatic-trimming-reads">Trimmomatic (trimming reads)</h3>
<p><a href="http://www.usadellab.org/cms/?page=trimmomatic">Trimmomatic</a> performs a variety of useful trimming tasks for illumina paired-end and single ended data.The selection of trimming steps and their associated parameters are supplied on the command line.</p>
<p>The following command line will perform the following:<br />
    • Remove adapters (ILLUMINACLIP:TruSeq3-PE.fa:2:30:10)<br />
    • Remove leading low quality or N bases (below quality 3) (LEADING:3)<br />
    • Remove trailing low quality or N bases (below quality 3) (TRAILING:3)<br />
    • Scan the read with a 4-base wide sliding window, cutting when the average quality per base drops below 15 (SLIDINGWINDOW:4:15)<br />
    • Drop reads below the 36 bases long (MINLEN:36)  </p>
<pre><code>cd ~/annotation_course/practical2/RNAseq
mkdir trimmomatic
cd trimmomatic

java -jar trimmomatic-0.32.jar PE -threads 8 ~/annotation_course/data/RNAseq/fastq/ERR305399.left.fastq.gz ~/annotation_course/data/RNAseq/fastq/ERR305399.right.fastq.gz ERR305399.left_paired.fastq.gz ERR305399.left_unpaired.fastq.gz ERR305399.right_paired.fastq.gz ERR305399.right_unpaired.fastq.gz ILLUMINACLIP:trimmomatic/0.32/adapters/TruSeq3-PE.fa:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36
</code></pre>

<h3 id="tophat-splice-aware-mapping-reads-to-genome">Tophat (splice-aware mapping reads to genome)</h3>
<p>Once the reads have been trimmed, we use <a href="https://ccb.jhu.edu/software/tophat/index.shtml">tophat</a> to align the RNA-seq reads to a genome in order to identify exon-exon splice junctions. It is built on the ultrafast short read mapping program <a href="http://bowtie-bio.sourceforge.net/index.shtml">Bowtie</a>.</p>
<pre><code>cd ~/annotation_course/practical2/RNAseq
mkdir tophat
cd tophat

tophat --library-type=fr-firststrand ~/annotation_course/data/genome/4.fa ../trimmomatic/ERR305399.left_paired.fastq.gz ../trimmomatic/ERR305399.right_paired.fastq.gz -p 8
</code></pre>

<p>This step will take a really long time so you can use the bam file located here ~/annotation_course/data/RNAseq/tophat/accepted_hits.bam</p>
<h3 id="stringtie-assembling-reads-into-transcripts">Stringtie (Assembling reads into transcripts)</h3>
<p>StringTie is a fast and highly efficient assembler of RNA-Seq alignments into potential transcripts. It uses a novel network flow algorithm as well as an optional de novo assembly step to assemble and quantitate full-length transcripts representing multiple splice variants for each gene locus. Its input can include not only the alignments of raw reads used by other transcript assemblers, but also alignments longer sequences that have been assembled from those reads.</p>
<pre><code>cd ~/annotation_course/practical2/RNAseq
mkdir stringtie
cd stringtie

stringtie ../tophat/tophat_out/accepted_hits.bam -o outdir/transcripts.gtf
</code></pre>

<p>When done you can find your results in the directory ‘outdir’. The file transcripts.gtf includes your assembled transcripts.
As Webapollo doesn't like the gtf format file you should convert it in gff3 format.</p>
<pre><code>gxf_to_gff3.pl --gff transcripts.gtf -o transcripts.gff3
</code></pre>

<p>Then, transfer the gff3 file to your computer and load it into <a href="http://annotation-prod.scilifelab.se:8080/NBIS_course/">Webapollo</a>. How well does it compare with your Augustus results? Looking at your results, are you happy with the default values of Stringtie (which we used in this exercise) or is there something you would like to change?</p>
<h2 id="2-de-novo-transcriptome-assembly">2. De-novo transcriptome assembly:</h2>
<h3 id="trinity">Trinity</h3>
<p>Trinity assemblies can be used as complementary evidence, particularly when trying to polish a gene build with Pasa. Before you start, check how big the raw read data is that you wish to assemble to avoid unreasonably long run times.</p>
<pre><code>cd ~/annotation_course/practical2/RNAseq
mkdir trinity
cd trinity

Trinity --seqType fq --max_memory 64G --left ~/annotation_course/data/RNAseq/ERR305399.left.fastq.gz --right ~/annotation_course/data/RNAseq/ERR305399.right.fastq.gz --CPU 8 --output trinity_result --SS_lib_type RF 
</code></pre>

<p>Trinity takes a long time to run if you want to have a look at the results, look in ~/annotation_course/course_material/data/dmel/chromosome_4/RNAseq/ the output that will be used later on for the annotation will be Trinity.fasta</p>
<h2 id="closing-remarks">Closing remarks</h2>
<p>You have now successfully perform transcript assemblies. You have seen how to perform a genome-guided assembly as well as de-no assembly.</p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
        
        
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <!-- <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script> -->
    <script src="../../../js/base.js"></script>
    <script src="../../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
